<!DOCTYPE html>
<html>
<head>
    <title>Audio Playback Test</title>
</head>
<body>
    <h1>Audio Playback Test</h1>
    <button onclick="testAudio()">Test Audio Playback</button>
    <div id="status"></div>
    
    <script>
    function testAudio() {
        // Fetch audio from voice endpoint
        fetch('http://localhost:5024/api/voice/conversation', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                audio_data: btoa(new Uint8Array(16000).fill(0)),
                session_id: 'test',
                domain: 'budtender'
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.audio_response) {
                const audio = new Audio(data.audio_response);
                audio.loop = false;
                
                audio.addEventListener('play', () => {
                    document.getElementById('status').innerHTML += '<p>Audio started playing</p>';
                });
                
                audio.addEventListener('ended', () => {
                    document.getElementById('status').innerHTML += '<p>Audio ended</p>';
                });
                
                audio.addEventListener('error', (e) => {
                    document.getElementById('status').innerHTML += '<p>Audio error: ' + e.message + '</p>';
                });
                
                audio.play().catch(err => {
                    document.getElementById('status').innerHTML += '<p>Play failed: ' + err + '</p>';
                });
            } else {
                document.getElementById('status').innerHTML = '<p>No audio response</p>';
            }
        })
        .catch(err => {
            document.getElementById('status').innerHTML = '<p>Error: ' + err + '</p>';
        });
    }
    </script>
</body>
</html>
